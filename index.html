<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Encrypted Transmission</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #1e1e1e;
  font-family: "Courier New", monospace;
  height: 100%;
  overflow: hidden;
}

#editor {
  padding: 60px;
  font-size: 18px;
  line-height: 1.8;
  color: #d4d4d4;
}

/* Cursor */
.cursor {
  display: inline-block;
  width: 8px;
  background: #d4d4d4;
  margin-left: 2px;
  animation: blink 1s infinite;
}
@keyframes blink {
  0%,50%,100% { opacity: 1; }
  25%,75% { opacity: 0; }
}

/* VS Code Dark+ */
.token-keyword   { color: #569CD6; }
.token-string    { color: #CE9178; }
.token-function  { color: #DCDCAA; }
.token-number    { color: #B5CEA8; }
.token-operator  { color: #d4d4d4; }
.token-brace     { color: #FFD700; }
.token-dot       { color: #9CDCFE; }
.token-semicolon { color: #d4d4d4; }
.token-property  { color: #9CDCFE; }

/* Suggestions */
#suggestions {
  position: absolute;
  background: #252526;
  border: 1px solid #3c3c3c;
  padding: 6px 0;
  font-size: 14px;
  color: #d4d4d4;
  width: 220px;
  display: none;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  border-radius: 4px;
}
.suggestion-item {
  padding: 6px 12px;
}
.suggestion-item:hover {
  background: #094771;
}
</style>
</head>

<body>

<div id="editor"></div>

<div id="suggestions">
  <div class="suggestion-item">inject(identity: string)</div>
  <div class="suggestion-item">transmit(packet: string)</div>
  <div class="suggestion-item">maintain()</div>
  <div class="suggestion-item">encrypt(payload: object)</div>
</div>

<script>

const editor = document.getElementById("editor");
const suggestions = document.getElementById("suggestions");

/* Structured code model */
const codeStructure = [
  { type: "blockStart", content: `<span class="token-keyword">class</span> <span class="token-function">Transmission</span> <span class="token-brace">{</span>` },

  { type: "blockStart", content: `    <span class="token-keyword">public</span> <span class="token-keyword">static</span> <span class="token-keyword">void</span> <span class="token-function">main</span><span class="token-brace">(</span><span class="token-string">String[] args</span><span class="token-brace">)</span> <span class="token-brace">{</span>` },

  { type: "line", content: `        <span class="token-property">System</span><span class="token-dot">.</span><span class="token-function">out</span><span class="token-dot">.</span><span class="token-function">println</span><span class="token-brace">(</span><span class="token-string">"Initializing secure channel..."</span><span class="token-brace">)</span><span class="token-semicolon">;</span>` },

  { type: "blockStart", content: `        <span class="token-keyword">if</span> <span class="token-brace">(</span><span class="token-property">visibility</span> <span class="token-operator">==</span> <span class="token-keyword">false</span><span class="token-brace">)</span> <span class="token-brace">{</span>` },

  { type: "line", content: `            <span class="token-property">identity</span><span class="token-dot">.</span><span class="token-function">inject</span><span class="token-brace">(</span><span class="token-string">"Cipher"</span><span class="token-brace">)</span><span class="token-semicolon">;</span>` },

  { type: "blockStart", content: `            <span class="token-keyword">for</span> <span class="token-brace">(</span><span class="token-keyword">int</span> i <span class="token-operator">=</span> <span class="token-number">0</span><span class="token-semicolon">;</span> i <span class="token-operator"><</span> <span class="token-number">3</span><span class="token-semicolon">;</span> i<span class="token-operator">++</span><span class="token-brace">)</span> <span class="token-brace">{</span>` },

  { type: "line", content: `                <span class="token-property">network</span><span class="token-dot">.</span><span class="token-function">transmit</span><span class="token-brace">(</span><span class="token-string">"Encrypted Packet"</span><span class="token-brace">)</span><span class="token-semicolon">;</span>` },

  { type: "blockEnd", content: `            <span class="token-brace">}</span>` },

  { type: "blockEnd", content: `        <span class="token-brace">}</span>` },

  { type: "blockStart", content: `        <span class="token-keyword">while</span> <span class="token-brace">(</span><span class="token-property">connection</span> <span class="token-operator">!=</span> <span class="token-keyword">null</span><span class="token-brace">)</span> <span class="token-brace">{</span>` },

  { type: "line", content: `            <span class="token-property">connection</span><span class="token-dot">.</span><span class="token-function">maintain</span><span class="token-brace">(</span><span class="token-brace">)</span><span class="token-semicolon">;</span>` },

  { type: "blockEnd", content: `        <span class="token-brace">}</span>` },

  { type: "blockEnd", content: `    <span class="token-brace">}</span>` },

  { type: "blockEnd", content: `<span class="token-brace">}</span>` }
];


/* Suggestion popup */
function showSuggestions(x, y) {
  suggestions.style.left = x + "px";
  suggestions.style.top = y + "px";
  suggestions.style.display = "block";
  setTimeout(() => suggestions.style.display = "none", 900);
}


/* Safe typing (character-by-character without breaking tags) */
function typeHTML(element, html, speed = 12, callback) {
  const temp = document.createElement("div");
  temp.innerHTML = html;
  const nodes = Array.from(temp.childNodes);

  function typeNode(node, parent, done) {
    if (node.nodeType === 3) {
      let i = 0;
      const text = node.textContent;
      const span = document.createTextNode("");
      parent.appendChild(span);

      const interval = setInterval(() => {
        span.textContent += text[i];
        i++;
        if (i >= text.length) {
          clearInterval(interval);
          done();
        }
      }, speed);

    } else {
      const clone = node.cloneNode(false);
      parent.appendChild(clone);
      const children = Array.from(node.childNodes);
      let index = 0;

      function nextChild() {
        if (index >= children.length) {
          done();
          return;
        }
        typeNode(children[index], clone, () => {
          index++;
          nextChild();
        });
      }
      nextChild();
    }
  }

  let index = 0;
  function next() {
    if (index >= nodes.length) {
      if (callback) callback();
      return;
    }
    typeNode(nodes[index], element, () => {
      index++;
      next();
    });
  }

  next();
}


/* Main animation engine */
function startTyping() {
  let index = 0;

  function nextLine() {
    if (index >= codeStructure.length) return;

    const line = codeStructure[index];
    const div = document.createElement("div");
    editor.appendChild(div);

    if (line.type === "blockStart") {
      div.innerHTML = line.content;
      index++;
      setTimeout(nextLine, 200);
    }
    else if (line.type === "blockEnd") {
      div.innerHTML = line.content;
      index++;
      setTimeout(nextLine, 200);
    }
    else {
      typeHTML(div, line.content, 12, () => {
        index++;
        setTimeout(nextLine, 200);
      });
    }

    if (line.content.includes("token-dot")) {
      const rect = div.getBoundingClientRect();
      showSuggestions(rect.left + 280, rect.top + 20);
    }
  }

  nextLine();
}

startTyping();

</script>

</body>
</html>
